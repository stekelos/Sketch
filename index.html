<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mood Color Diary (Pie Chart)</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            text-align: center;
            background-color: #f0f0f0;
        }
        .toolbox {
            margin: 20px 0;
        }
        canvas {
            border: 1px solid #ccc;
            background: white;
            margin: 10px auto;
            display: block;
            cursor: pointer;
        }
        #legend {
            margin-top: 10px;
        }
        #colorChoices {
            position: absolute;
            display: none;
            background: white;
            border: 1px solid #ccc;
            padding: 5px;
        }
        .colorOption {
            width: 20px;
            height: 20px;
            display: inline-block;
            margin: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h2>Mood Color Diary (Pie Chart)</h2>
    <div class="toolbox">
        <button onclick="addNewSlice()">Προσθήκη Νέας Ημέρας</button>
    </div>
    <canvas id="moodCanvas" width="400" height="400"></canvas>
    <div id="legend"></div>
    <div id="colorChoices">
        <div class="colorOption" style="background-color: #FFFF00" onclick="selectColor(0)"></div>
        <div class="colorOption" style="background-color: #FFA500" onclick="selectColor(1)"></div>
        <div class="colorOption" style="background-color: #FF0000" onclick="selectColor(2)"></div>
    </div>

    <script>
        const canvas = document.getElementById('moodCanvas');
        const ctx = canvas.getContext('2d');
        const colors = ['#FFFF00', '#FFA500', '#FF0000']; // Κίτρινο, Πορτοκαλί, Κόκκινο
        const colorChoices = document.getElementById('colorChoices');
        let moods = [];
        let selectedSlice = -1;

        // Λειτουργίες για cookies
        function setCookie(name, value) {
            // Αποθηκεύει τα δεδομένα σε cookie χωρίς ημερομηνία λήξης (μόνιμο)
            document.cookie = `${name}=${encodeURIComponent(JSON.stringify(value))}; path=/`;
        }

        function getCookie(name) {
            // Φορτώνει τα δεδομένα από το cookie
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return JSON.parse(decodeURIComponent(parts.pop().split(';').shift()));
            return null;
        }

        // Φόρτωση moods από cookie κατά την εκκίνηση
        moods = getCookie('moods') || [];

        // Εμφάνιση πίτας
        function renderPieChart() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const radius = Math.min(centerX, centerY) - 20;
            const total = moods.length || 1;
            const sliceAngle = (2 * Math.PI) / total;

            moods.forEach((mood, index) => {
                const startAngle = index * sliceAngle;
                const endAngle = startAngle + sliceAngle;

                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, radius, startAngle, endAngle);
                ctx.closePath();
                ctx.fillStyle = colors[mood.state];
                ctx.fill();
                ctx.strokeStyle = '#000';
                ctx.stroke();
            });

            updateLegend();
            if (moods.length === 0) {
                ctx.fillStyle = '#000';
                ctx.fillText('Κάνε κλικ για να ξεκινήσεις!', centerX - 80, centerY);
            }
        }

        // Ενημέρωση λεζάντας
        function updateLegend() {
            const legend = document.getElementById('legend');
            legend.innerHTML = moods.map(mood => 
                `<span style="color: ${colors[mood.state]}">■</span> ${new Date(mood.date).toLocaleDateString('el-GR')}`
            ).join('<br>');
        }

        // Προσθήκη νέας ημέρας
        function addNewSlice() {
            const today = new Date();
            const latestDate = moods.length > 0 ? new Date(Math.max(...moods.map(m => new Date(m.date)))) : today;
            const nextDate = new Date(latestDate);
            nextDate.setDate(nextDate.getDate() + 1); // Επόμενη μέρα

            moods.push({ date: nextDate.toISOString(), state: 0 }); // Ξεκινά με κίτρινο
            setCookie('moods', moods); // Αποθήκευση στο cookie
            renderPieChart();
        }

        // Επιλογή χρώματος
        function selectColor(state) {
            if (selectedSlice !== -1) {
                moods[selectedSlice].state = state;
                setCookie('moods', moods); // Ενημέρωση cookie μετά την επιλογή χρώματος
                renderPieChart();
            }
            colorChoices.style.display = 'none';
            selectedSlice = -1;
        }

        // Χειρισμός κλικ στην πίτα
        canvas.addEventListener('click', (e) => {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left - canvas.width / 2;
            const y = e.clientY - rect.top - canvas.height / 2;
            const distance = Math.sqrt(x * x + y * y);
            const radius = Math.min(canvas.width / 2, canvas.height / 2) - 20;

            if (distance <= radius) { // Εντός της πίτας
                const angle = Math.atan2(y, x) < 0 ? Math.atan2(y, x) + 2 * Math.PI : Math.atan2(y, x);
                const total = moods.length || 1;
                const sliceAngle = (2 * Math.PI) / total;
                selectedSlice = Math.floor(angle / sliceAngle);

                if (moods.length === 0) {
                    addNewSlice(); // Αυτόματη προσθήκη πρώτης ημέρας
                } else if (selectedSlice < moods.length) {
                    // Εμφάνιση επιλογών χρώματος
                    colorChoices.style.left = `${e.clientX}px`;
                    colorChoices.style.top = `${e.clientY}px`;
                    colorChoices.style.display = 'block';
                }
            }
        });

        // Κλείσιμο επιλογών χρώματος αν κάνεις κλικ αλλού
        document.addEventListener('click', (e) => {
            if (!colorChoices.contains(e.target) && e.target !== canvas) {
                colorChoices.style.display = 'none';
                selectedSlice = -1;
            }
        });

        // Αρχική εμφάνιση
        renderPieChart();
    </script>
</body>
</html>

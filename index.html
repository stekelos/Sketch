<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mood Color Diary (Grid)</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            text-align: center;
            background-color: #f0f0f0;
        }
        .toolbox {
            margin: 20px 0;
        }
        #grid {
            max-width: 350px;
            margin: 10px auto;
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
        }
        .day {
            width: 40px;
            height: 40px;
            border: 1px solid #ccc;
            cursor: pointer;
            position: relative;
        }
        #colorChoices {
            position: absolute;
            display: none;
            background: white;
            border: 1px solid #ccc;
            padding: 5px;
            z-index: 10;
        }
        .colorOption {
            width: 20px;
            height: 20px;
            display: inline-block;
            margin: 5px;
            cursor: pointer;
        }
        #legend {
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h2>Mood Color Diary (Grid)</h2>
    <div class="toolbox">
        <button onclick="addNewDay()">Προσθήκη Νέας Ημέρας</button>
        <button onclick="confirmDelete()">Διαγραφή Όλων</button>
    </div>
    <div id="grid"></div>
    <div id="legend"></div>
    <div id="colorChoices">
        <div class="colorOption" style="background-color: #FFFF00" onclick="selectColor(0)"></div>
        <div class="colorOption" style="background-color: #FFA500" onclick="selectColor(1)"></div>
        <div class="colorOption" style="background-color: #FF0000" onclick="selectColor(2)"></div>
    </div>

    <script>
        const grid = document.getElementById('grid');
        const colorChoices = document.getElementById('colorChoices');
        const colors = ['#FFFF00', '#FFA500', '#FF0000']; // Κίτρινο, Πορτοκαλί, Κόκκινο
        let moods = [];
        let selectedDay = -1;

        // Λειτουργίες για cookies
        function setCookie(name, value) {
            document.cookie = `${name}=${encodeURIComponent(JSON.stringify(value))}; path=/`; // Μόνιμο cookie
        }

        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return JSON.parse(decodeURIComponent(parts.pop().split(';').shift()));
            return null;
        }

        // Φόρτωση από cookie
        moods = getCookie('moods') || [];

        // Εμφάνιση πλέγματος
        function renderGrid() {
            grid.innerHTML = '';
            moods.forEach((mood, index) => {
                const day = document.createElement('div');
                day.className = 'day';
                day.style.backgroundColor = colors[mood.state];
                day.title = new Date(mood.date).toLocaleDateString('el-GR');
                day.dataset.index = index;
                day.addEventListener('click', showColorChoices);
                grid.appendChild(day);
            });
            updateLegend();
        }

        // Ενημέρωση λεζάντας
        function updateLegend() {
            const legend = document.getElementById('legend');
            legend.innerHTML = moods.map(mood => 
                `<span style="color: ${colors[mood.state]}">■</span> ${new Date(mood.date).toLocaleDateString('el-GR')}`
            ).join('<br>');
            if (moods.length === 0) {
                legend.innerHTML = 'Πρόσθεσε την πρώτη σου ημέρα!';
            }
        }

        // Προσθήκη νέας ημέρας
        function addNewDay() {
            const today = new Date();
            const latestDate = moods.length > 0 ? new Date(Math.max(...moods.map(m => new Date(m.date)))) : today;
            const nextDate = new Date(latestDate);
            nextDate.setDate(nextDate.getDate() + 1);

            moods.push({ date: nextDate.toISOString(), state: 0 }); // Ξεκινά με κίτρινο
            setCookie('moods', moods); // Αποθήκευση στο cookie
            renderGrid();
        }

        // Εμφάνιση επιλογών χρώματος
        function showColorChoices(e) {
            selectedDay = parseInt(e.target.dataset.index);
            const rect = e.target.getBoundingClientRect();
            colorChoices.style.left = `${rect.left + window.scrollX}px`;
            colorChoices.style.top = `${rect.bottom + window.scrollY}px`;
            colorChoices.style.display = 'block';
        }

        // Επιλογή χρώματος
        function selectColor(state) {
            if (selectedDay !== -1) {
                moods[selectedDay].state = state;
                setCookie('moods', moods); // Ενημέρωση cookie
                renderGrid();
            }
            colorChoices.style.display = 'none';
            selectedDay = -1;
        }

        // Διαγραφή με επιβεβαίωση
        function confirmDelete() {
            if (moods.length === 0) {
                alert('Δεν υπάρχουν εγγραφές για διαγραφή!');
                return;
            }
            if (confirm('Είσαι σίγουρος ότι θέλεις να διαγράψεις όλες τις εγγραφές;')) {
                moods = [];
                setCookie('moods', moods); // Ενημέρωση cookie με κενή λίστα
                renderGrid();
            }
        }

        // Κλείσιμο επιλογών χρώματος αν κάνεις κλικ αλλού
        document.addEventListener('click', (e) => {
            if (!colorChoices.contains(e.target) && !e.target.classList.contains('day')) {
                colorChoices.style.display = 'none';
                selectedDay = -1;
            }
        });

        // Αρχική εμφάνιση
        renderGrid();
    </script>
</body>
</html>
